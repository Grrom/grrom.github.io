(()=>{"use strict";var e={795:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnimeServer=void 0;var r=n(605),o=n(949),a=n(589),i=n(583);t.AnimeServer=function(){r.createServer((function(e,t){switch(e.method){case"GET":a.getRoutes(e,t);break;case"POST":i.postRoutes(e,t);case"OPTIONS":t.writeHead(200,{"Access-Control-Allow-Headers":"Content-Type, Accept","Access-Control-Allow-Origin":o.allowedOrigin(e.headers.origin),"Access-Control-Allow-Methods":"POST"}),t.end()}})).listen(o.port,o.hostname,(function(){console.log("Server running at http://"+o.hostname+":"+o.port+"/")}))}},949:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.noEndpoint=t.allowedOrigin=t.whitelisted=t.port=t.hostname=void 0,t.hostname="127.0.0.1",t.port=3e3,t.whitelisted=function(e){return["127.0.0.1"].includes(e)},t.allowedOrigin=function(e){return["http://localhost:8080"].includes(e)?e:"https://www.youtube.com/watch?v=dQw4w9WgXcQ"},t.noEndpoint=function(e){var t=e.headers.accept.split(",")[0],n="no resource found",r={"Content-Type":t,"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET"};switch(t){case"text/html":n="<h1>The resource you requested is not available</h1>",n+="<h4>Here, get rickrolled instead</h4>",n+="<img src='https://media.giphy.com/media/Vuw9m5wXviFIQ/giphy.gif'></img>";break;case"application/json":default:n=JSON.stringify("We couldn't find the resource you requested, check this out instead: https://www.youtube.com/watch?v=dQw4w9WgXcQ ")}return console.log("no endpoint for "+e.pathname),{statusCode:200,headers:r,data:n}}},312:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAsset=t.MyAnimeClient=t.video=t.animeList=void 0;var r=n(747),o=n(949);t.animeList=function(e){var t={"Content-Type":"application/json","Access-Control-Allow-Origin":o.allowedOrigin(e),"Access-Control-Allow-Methods":"GET"},n={};try{n=JSON.parse(r.readFileSync("./watched.json","utf8"))}catch(e){"ENOENT"===e.code&&console.log("File Doesn't exist")}var a={};r.readdirSync("./anime").forEach((function(e){".keep"!==e&&(a[e]=r.readdirSync("./anime/"+e))}));var i={};return Object.keys(a).forEach((function(e){i[e]=[],a[e].forEach((function(t){var r=void 0!==n[e]?n[e].map((function(e){return e.episode})).indexOf(t):-1;i[e].push({episode:t,watched:r>=0,timeStamp:r>=0?n[e][r].timeStamp:0})}))})),{statusCode:200,headers:t,data:JSON.stringify(i)}},t.video=function e(t,n){var a=t.searchParams,i="./anime/"+a.get("anime")+"/"+a.get("episode"),s=r.statSync(i).size,c=n.range;if(c){var d=Math.pow(10,6),l=Number(c.replace(/\D/g,"")),u=Math.min(l+d,s-1),p={"Content-Range":"bytes "+l+"-"+u+"/"+s,"Accept-Ranges":"bytes","Content-Length":u-l+1,"Content-Type":"video/mp4","Access-Control-Allow-Origin":o.allowedOrigin(n.origin),"Access-Control-Allow-Headers":"Range","Access-Control-Allow-Methods":"GET"};return{data:r.createReadStream(i,{start:l,end:u}),headers:p,statusCode:206}}return{statusCode:200,headers:p={"Content-Length":e,"Content-Type":"video/mp4","Accept-Ranges":"bytes","Access-Control-Allow-Headers":"Range","Access-Control-Allow-Origin":o.allowedOrigin(n.origin),"Access-Control-Allow-Methods":"GET"},data:r.createReadStream(i)}},t.MyAnimeClient=function(e){return{statusCode:200,headers:{"Content-Type":"text/html","Access-Control-Allow-Origin":o.allowedOrigin(e),"Access-Control-Allow-Methods":"GET"},data:r.readFileSync("./client/index.html","utf8")}},t.getAsset=function(e,t,n){var a,i="utf-8";switch(t){case"ttf":a="application/octet-stream",i="utf-8";break;case"js":a="application/javascript",i="utf-8"}return{statusCode:200,headers:{"Content-Type":a,"Access-Control-Allow-Origin":o.allowedOrigin(n),"Access-Control-Allow-Methods":"GET"},data:e=r.readFileSync("./client"+e,i)}}},183:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.saveProgress=void 0;var a=n(619),i=n(747),s=n(949);t.saveProgress=function(e){var t={"Accept-Post":"application/json ","Content-Type":"application/json","Access-Control-Allow-Origin":s.allowedOrigin(e.headers.origin),"Access-Control-Allow-Methods":"POST"},n=[];return e.on("data",(function(e){n.push(e)})),e.on("end",(function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){return e=Buffer.concat(n),c(JSON.parse(e.toString())),[2]}))}))})),{statusCode:200,headers:t,data:JSON.stringify("save progresss")};function c(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t="./watched.json",i.access(t,a.F_OK,(function(n){var r=!1;if(n)i.openSync(t,"w"),c(e);else{var o=i.readFileSync(t,"utf8"),a=0!==o.length?JSON.parse(o):{};if(void 0===a[e.name]&&(a[e.name]=[]),a[e.name].map((function(e){return e.episode})).includes(e.episode)){if(void 0!==e.timeStamp){var s=a[e.name].map((function(e){return e.episode})).indexOf(e.episode);a[e.name][s].timeStamp=e.timeStamp,r=!0}}else a[e.name].push({episode:e.episode,timeStamp:0}),r=!0;r&&i.writeFile(t,JSON.stringify(a),(function(e){if(e)throw e}))}})),[2]}))}))}}},589:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRoutes=void 0;var r=n(949),o=n(312);t.getRoutes=function(e,t){var n=(void 0!==e.headers.referer?e.headers.referer.split(":")[0]:"http")+"://"+e.headers.host+"/",a=new URL(e.url,n),i=e.headers.origin;if(r.whitelisted(e.ip||e.connection.remoteAddress||e.socket.remoteAddress))switch(a.pathname){case"/":var s=o.MyAnimeClient(i);t.writeHead(s.statusCode,s.headers),t.write(s.data),t.end();break;case"/anime-list":var c=o.animeList(i);t.writeHead(c.statusCode,c.headers),t.write(c.data),t.end();break;case"/video":var d=o.video(a,e.headers);t.writeHead(d.statusCode,d.headers),d.data.pipe(t);break;default:var l=a.pathname.split(".").pop();if(["js"].includes(l)){var u=o.getAsset(a.pathname,l,i);t.writeHead(u.statusCode,u.headers),t.write(u.data),t.end()}else{var p=r.noEndpoint(e);t.writeHead(p.statusCode,p.headers),t.write(p.data),t.end()}}}},583:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postRoutes=void 0;var r=n(949),o=n(183);t.postRoutes=function(e,t){var n=e.headers.referer.split(":")[0]+"://"+e.headers.host+"/";switch(new URL(e.url,n).pathname){case"/save-progress":var a=o.saveProgress(e);t.writeHead(a.statusCode,a.headers),t.write(a.data),t.end();break;default:var i=r.noEndpoint(e);t.writeHead(i.statusCode,i.headers),t.write(i.data),t.end()}}},619:e=>{e.exports=require("constants")},747:e=>{e.exports=require("fs")},605:e=>{e.exports=require("http")}},t={};new(function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}(795).AnimeServer)})();